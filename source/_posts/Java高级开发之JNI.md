---
title: Java高级开发之JNI
date: 2021-08-02 17:38:04
# 文章出处名称 #
from:
# 文章出处链接 #
url:
# 文章作者名称 #
author: p0ny
# 文章作者签名 #
about:
# 文章作者头像 #
avatar:
# 是否开启评论 #
comments: true
# 文章标签 #
tags: java JNI
# 文章分类 #
categories: Java
# 文章摘要 #
description: Java高级开发之JNI
# 文章置顶 #
sticky: 10000
---
### JNI【Java Native Interface】
>1. 什么是JNI
>   java本地开发接口，相当于桥梁的作用，一种协议。通过JNI可以让 java 调用 C/C++，或者让C/C++ 来调用 java代码


#### JNI 环境配置
1. 配置 下载 NDK 并且配置其环境
    
   ![下载 NDK](https://gitee.com/coder_p0ny/md-nice-markdown_pic/raw/master/2021-8-2/1627890447467-image.png)
   
   下载完成配置环境变量进 PATH 中
   ![下载工具](https://gitee.com/coder_p0ny/md-nice-markdown_pic/raw/master/2021-8-2/1627890299654-image.png)
   
   




1. 创建一个 Helloworld app项目
2. 在 `com.example.app` 包下创建 JNI类
   ![](https://gitee.com/coder_p0ny/md-nice-markdown_pic/raw/master/2021-8-2/1627889725728-image.png)
   
   `JNI.java`
   
   ```java
   package com.example.app;

    public class JNI {
    static {
        System.loadLibrary("test_lib");
    }
    /*
        定义 Navive方法
     */
    public static native String sayHello();

   }
   ```
   
   `MainActivity .java`
   
   ```java
   package com.example.app;

    import androidx.appcompat.app.AppCompatActivity;

    import android.os.Bundle;

    public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        JNI jni = new JNI();
        System.out.println(jni.sayHello());

        }
   }
   ```
   
   
3. 在 `main` 下创建JNI包，在 JNI包下创建 .c 文件，在 app模块根路径下创建 `CMakeLists.txt` 文件
   
   ![](https://gitee.com/coder_p0ny/md-nice-markdown_pic/raw/master/2021-8-2/1627890043007-image.png)
   
   `Hello.c`
   ```c
   /* DO NOT EDIT THIS FILE - it is machine generated */
    #include <jni.h>
    #include "stdio.h"
    #include "stdlib.h"
    
     jstring Java_com_example_app_JNI_sayHello(JNIEnv* env,jobject jobj) {
         char *text = "我会简单的 JNI";
         return (*env)->NewStringUTF(env, text);
     }
   ```
   
   `CMakeLists.txt` 
   ```txt
   # CMake的编译脚本配置文件

    # 1. 标注需要支持的CMake最小版本
    cmake_minimum_required(VERSION 3.4.1)

    # 2. add_library 定义需要编译的代码库 名称, 类型, 包含的源码
    add_library(
                # Sets the name of the library.
                test_lib
                # Sets the library as a shared library.
                SHARED
            src/main/jni/Hello.c
    )

    # 3. find_library 定义当前代码库需要依赖的系统或者第三方库文件(可以写多个)
    find_library(
            log_lib # 指定要查找的系统库, 给一个名字
            log     # 真正要查找的liblog.so或者liblog.a
    )

    # 4. target_link_libraries设置最终编译的目标代码库
    target_link_libraries(
            test_lib  # add_library 生成的
         ${log_lib} # find_library 找到的系统库
    )
   ```
   
   
   
   ![配置](https://gitee.com/coder_p0ny/md-nice-markdown_pic/raw/master/2021-8-2/1627890614340-image.png)
   
   `build.gradle` 【是app下的根路径，不是项目根路径】
   ```gradle
   plugins {
    id 'com.android.application'
    }

    android {
    compileSdkVersion 30
    buildToolsVersion "30.0.3"
    ndkVersion '22.1.7171670'

    defaultConfig {
        applicationId "com.example.app"
        minSdkVersion 16
        targetSdkVersion 30
        versionCode 1
        versionName "1.0"

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"

        ndk{
            moduleName "Hello" // so文件  lin + moduleName + .so
            abiFilters 'armeabi-v7a', 'arm64-v8a', 'x86', 'x86_64' // cpu架构
        }


    }

    externalNativeBuild {
        cmake {
            path "CMakeLists.txt"
        }
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
   }

   dependencies {

    implementation 'androidx.appcompat:appcompat:1.3.0'
    implementation 'com.google.android.material:material:1.4.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.0.4'
    testImplementation 'junit:junit:4.+'
    androidTestImplementation 'androidx.test.ext:junit:1.1.3'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'
   }
   ```
   
   `local.properties`
   ```properties
   sdk.dir=D\:\\DevelopKitTools\\android_sdk
    #ndk.dir=D\:\\DevelopKitTools\\android_sdk\\ndk-bundle
    ndk.dir=D\:\\DevelopKitTools\\android_sdk\\ndk\\22.1.7171670

   ```
   
   `MainActivity.java`
   
   ```java
   package com.example.app;

    import androidx.appcompat.app.AppCompatActivity;
    import android.os.Bundle;
    
    public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        JNI jni = new JNI();
        System.out.println(jni.sayHello());
    }
   }
   ```
   
   
   ![效果图](https://gitee.com/coder_p0ny/md-nice-markdown_pic/raw/master/2021-8-2/1627890980730-image.png)



   
   
   
   
   






















